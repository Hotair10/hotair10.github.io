var ratLogJSON={};$(document).ready(function(){function e(e,t,i,s){var o=e.find('.ratImg img[src*="vegetarian.png"]').length>0?true:false,u=parseInt(e.prev(".statRow").find(".ratMeals").text()),a=parseInt(e.prev(".statRow").find(".ratExpHas").text()),f=0,l=parseInt(e.prev(".statRow").find(".ratExpLevel").text()),c=0,h=0,p=parseInt(t=="furlong"?9:t.toString().replace("food","")),d=rats[e.prev(".statRow").find(".ratName").text()]["Stats"],v=$("#calcFoodCostCheckbox").is(":checked"),m=parseInt($("#calcFoodCostLevel").val()),g=0,y=false,b=null;m=m>0?m:100;if(v==true){if(o==false&&p==1){b="Raw Chicken Leg";g=(m+3)/2;y=true}else if(p==2){g=100;b="Wonka Bar";if(2*(m+3)/2<100){g=2*(m+3)/2;b="Fresh Apple"}y=true}else if(p==3){g=500;b="Wonka-stripe Candy Cane";if(5*(m+3)/2<500){g=5*(m+3)/2;b="Chocolate Ice Cream"}y=true}else if(p==4){b="Red Hots";g=3e3;y=true}else if(p==5){b="Fighters Lunch";g=10*(m+3)/2*2;y=true}else if(p==9){g=1e4;b="Fruit by the Furlong";y=true}if(y=true){i=b;e.find("li.cashSpentFood .cashSpentFood").text(parseInt(e.find("li.cashSpentFood .cashSpentFood").text())+g*s);e.find("li.cashSpentTotal .cashSpent").text(parseInt(e.find("li.cashSpentUpgrades .cashSpentUpgrades").text())+parseInt(e.find("li.cashSpentFood .cashSpentFood").text()))}}if(p<7){h=p*2;c=10-p}else if(t=="food7"){h=16;c=2}else if(t=="food8"){h=20;c=0}else if(p==9){h=18;c=-8}c=((o==true?c+1:c)+1)*s;h=((o==true?h+1:h)+1)*s;f=a+h;r(e,"Fed "+s+" meals ("+i+") to rat, gaining "+h+" exp, "+c+" life");if(f<l){e.prev(".statRow").find(".ratExpHas").text(a+h)}else{while(f>=l){e.prev(".statRow").find(".ratExpLevel").text(l+3);e.prev(".statRow").find(".ratLevel").text(parseInt(e.prev(".statRow").find(".ratLevel").text())+1);e.prev(".statRow").find(".ratCheese").text(parseInt(e.prev(".statRow").find(".ratCheese").text())+1);e.prev(".statRow").find(".ratExpHas").text(f-l);e.prev(".statRow").find(".ratSpd").text(parseInt(e.prev(".statRow").find(".ratSpd").text())+d[1]);e.prev(".statRow").find(".ratAtk").text(parseInt(e.prev(".statRow").find(".ratAtk").text())+d[2]);e.prev(".statRow").find(".ratDef").text(parseInt(e.prev(".statRow").find(".ratDef").text())+d[3]);f=f-l;l=l+3;r(e,"Rat is now level "+e.prev(".statRow").find(".ratLevel").text()+"!")}}e.prev(".statRow").find(".ratLife").text(parseInt(e.prev(".statRow").find(".ratLife").text())+c);e.prev(".statRow").find(".ratMeals").text(u-s);n(e);if(o==true){e.find(".foodVegList").show()}else if(o==false){e.find(".foodList").show()}}function t(e){e.find(".upgradeList li").each(function(t){if(parseInt($(this).find("b.cheeseCost").text())>parseInt(e.prev(".statRow").find(".ratCheese").text())){$(this).find(".upgradeDisabled").remove();$(this).find("a").hide();$(this).append('<span class="upgradeDisabled">'+$(this).find("a").text()+"</span>")}else if($(this).find(".upgradeDisabled").length>0){$(this).find(".upgradeDisabled").remove();$(this).find("a").show()}})}function n(e,t){var n=parseInt(e.prev(".statRow").find(".ratMeals").text());if(t==true){e.find('.foodCheckbox input[type="checkbox"]').change(function(t){if($(this).is(":checked")){e.find(".foodCheckbox").hide();$(this).closest(".foodCheckbox").show()}else if(!$(this).is(":checked")){e.find(".foodCheckbox").show()}t.preventDefault()})}e.find(".foodList,.foodVegList").find("li .foodFeedAll").empty();if(n>0){e.find(".foodList,.foodVegList").find("li .foodDisabled").remove();e.find(".foodList,.foodVegList").find("li").each(function(e){var t=$(this).find("a").attr("class");if(n>1){$(this).find(".foodFeedAll").html('<a href="#" class="foodFeedAllLink '+t+'">Feed x'+n+"</a>")}});if(t!=true){e.find(".foodList,.foodVegList").find("a").show()}}else{e.find(".foodList,.foodVegList").find("li").each(function(e){$(this).find(".foodDisabled").remove();$(this).find("a").hide();$(this).prepend('<span class="foodDisabled">'+$(this).find("a").text()+"</span>")})}}function r(e,t){e.next(".ratLogRow").first().find(".ratLogArea").append("Age "+e.prev(".statRow").find(".ratAge").text()+" - "+t+"\n")}function i(i){var s=i.prev(".statRow");var o=s.attr("id").toString().replace("ratStatRow_","");var u=parseInt(i.prev(".statRow").find(".ratAge").text())+1;var a=parseInt(i.prev(".statRow").find(".ratLife").text())-(u-1)*2;var f=8,l=10,c=s.find(".ratName").text(),h="";var p=parseInt(s.find(".ratSpd").text()),d=parseInt(s.find(".ratAtk").text()),v=parseInt(s.find(".ratDef").text());ratLogJSON[o][u-1]=p+v+d;i.find(".foodList, .foodVegList, .upgradeList,.ratAbility").hide();if(c=="Two Headed Rat"){f=12;l=20}var m=parseInt(i.prev(".statRow").find(".ratMeals").text())+f;if($("#enforceMealLimit").is(":checked")&&m>l){m=l}i.prev(".statRow").find(".ratAge").text(u);i.prev(".statRow").find(".ratLife").text(a);if(a<0){i.find(".ratOpts a.fastForwardLink, .ratOpts a.feedLink").closest("li").remove();i.find(".upgradeList li").each(function(e){$(this).find(".upgradeDisabled").remove();$(this).find("a").hide();$(this).append('<span class="upgradeDisabled">'+$(this).find("a").text()+"</span>")});i.find(".ratLog").html("Dead. :(<br><br>Final Stats: "+p+"/"+d+"/"+v+" ("+(p+d+v)+" total)"+"<br><br>"+"Upgrades purchased: <br><br><ul>"+i.find(".upgradeList li").closest("ul").html()+"</ul>").show();r(i,"Rat died :(");r(i,"Final Stats: "+p+"/"+d+"/"+v+" ("+(p+d+v)+" total)");i.find(".ratOpts").remove();return}i.prev(".statRow").find(".ratMeals").text(m);n(i);t(i);if(i.find('.foodCheckbox input[type="checkbox"]:checked').length>0){var g=i.find('.foodCheckbox input[type="checkbox"]:checked').closest("li").find("a").first();e(i,g.attr("class"),g.text(),m);i.find(".foodList, .foodVegList, .upgradeList,.ratAbility").hide();h+="Auto feeding rat.. <br>"}i.find(".ratLog").first().html(h+"Magic 24 hour time travel complete!").show()}function s(e){var t=$("#chart").get(0).getContext("2d");var n=[],r=[];var i=0;while(ratLogJSON[e].hasOwnProperty(i)==true){if(i%2==0){n.push(i+1);r.push(ratLogJSON[e][i])}i++}var s=new Chart(t);var o={labels:n,datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:r}]};(new Chart(t)).Line(o);$("#chart").css("display","block").show();$(".hideGraphLink").show()}$("#optionsCheckbox").attr("checked",false).change(function(e){$("tr#optionsRow").toggle();e.preventDefault()});$("#calcFoodCostCheckbox").attr("checked",false).change(function(e){$("span.calcFoodCost").toggle();$("li.cashSpentUpgrades").toggle();$("li.cashSpentFood").toggle();e.preventDefault()});$("#ratSelect").empty();$.each(rats,function(e,t){$("#ratSelect").append('<option value="'+e+'">'+e+"</option>");var n=[],r=t["Location"].join("<br>");for(var i=0;i<t["Ability"].length;i++){n[i]='<span class="abilityType">'+t["Ability"][i]["Type"]+'</span><span class="abilityDesc">'+t["Ability"][i]["Description"]+"</span>"}n=n.join("<br>");var s='<td  class="sort_num">'+t["Stats"].join("</td><td>")+"</td>";$("#ratDetailTable tbody").append('<tr class="ratDetailRow"><td><b>'+e+"</b></td><td>"+n+"</td><td>"+r+"</td>"+s+"</tr>")});$("a#ratDetailLink").click(function(e){if(!$("#ratDetailTable").is(":visible")){$(this).text("Hide Detailed Rat List");$("#ratDetailTable").show()}else{$(this).text("Show Detailed Rat List");$("#ratDetailTable").hide()}});$("#ratDetailTable thead tr th").click(function(e){var t=this.cellIndex;var n=$(this).hasClass("sort_asc")?"desc":"asc";var r=$(this).hasClass("sort_num")?true:false;$(this).removeClass("sort_asc sort_desc").addClass("sort_"+n);var i=$("#ratDetailTable tbody");i.find("tr").sort(function(e,i){var s=$(e).find("td:eq("+t+")").text(),o=$(i).find("td:eq("+t+")").text();if(r==true){s=parseInt(s);o=parseInt(o)}return n=="desc"?s<o?1:s>o?-1:0:s>o?1:s<o?-1:0}).appendTo(i);e.preventDefault()});$("#ratAdd").click(function(e){var r=$("#ratSelect").val(),i=rats[r]["Stats"],s=rats[r]["Image"],o=(new Date).getTime().toString()+Math.floor(Math.random()*100+1).toString();ratLogJSON[o]=[];$("#ratTable tr#ratStatRow_master").clone().attr("id","ratStatRow_"+o).appendTo("#ratTable tbody").show();$("#ratTable tr#ratRow_master").clone().attr("id","ratRow_"+o).appendTo("#ratTable tbody").show();$("#ratTable tr#ratLog_master").clone().attr("id","ratLogRow_"+o).appendTo("#ratTable tbody").hide();var u=$("#ratTable").find("#ratStatRow_"+o),a=$("#ratTable").find("#ratRow_"+o);u.find(".ratName").text(r);u.find(".ratLife").text(i[0]);u.find(".ratSpd").text(i[1]);u.find(".ratAtk").text(i[2]);u.find(".ratDef").text(i[3]);ratLogJSON[o][0]=parseInt(i[1])+parseInt(i[2])+parseInt(i[3]);var f=[];for(var l=0;l<rats[r]["Ability"].length;l++){f[l]=rats[r]["Ability"][l]["Description"]}a.find(".ratAbility").html("<li>"+f.join("</li><li>")+"</li>");a.find(".ratImg div").html('<img width="120" height="80" border="0" title="'+r+'" src="img/'+s+'"></img>');a.find(".foodList, .foodVegList, .upgradeList").hide();t(a);n(a,true);e.preventDefault()});$("#ratTable").on("click","a",function(o){var u=$(this).closest("tr");if($(this).hasClass("showStatGraph")){s(u.prev(".statRow").attr("id").toString().replace("ratStatRow_",""));return false}u.find(".ratLog, .foodList, .foodVegList, .upgradeList, .ratAbility").hide();if($(this).hasClass("showRatLogLink")){u.next(".ratLogRow").toggle();$(".ratAbility").show()}else if($(this).closest("ul").is(".foodList, .foodVegList, .foodFeedAll")){var a=parseInt(u.prev(".statRow").find(".ratMeals").text()),f,l;f=$(this).closest("span").hasClass("foodFeedAll")?a:1;l=f>1?$(this).closest("li").find("a").first().text():$(this).text();e(u,$(this).attr("class").replace("foodFeedAllLink","").replace(" ",""),l,f)}else if($(this).hasClass("feedLink")){if(u.find('.ratImg img[src*="vegetarian.png"]').length>0){u.find(".foodVegList").show()}else{u.find(".foodList").show()}}else if($(this).hasClass("upgradeLink")){t(u);u.find(".upgradeList").show()}else if($(this).hasClass("upgradeVegLink")){var c=false,h=null;u.find(".ratImg").append('<img class="upgImg" src="img/vegetarian.png"></img>');u.find(".upgradeList li.upgradeVeg").wrap('<span style="text-decoration:line-through;"></span>');$(this).replaceWith("[Cost 4 cheese");if(u.find('.foodCheckbox input[type="checkbox"]:checked').length>0){h=u.find('.foodCheckbox input[type="checkbox"]:checked').closest("li").find("a").first().attr("class");c=true}u.find(".foodList").remove();u.prev(".statRow").find(".ratCheese").text(parseInt(u.prev(".statRow").find(".ratCheese").text())-4);t(u);r(u,"Vegetarian upgrade purchased");u.find(".upgradeList").show();if(c==true){u.find(".foodVegList a."+h).closest("li").find(".foodCheckbox").show();u.find(".foodVegList a."+h).closest("li").find('.foodCheckbox input[type="checkbox"]').attr("checked",true)}}else if($(this).hasClass("upgradeBuddhismLink")){u.find(".ratImg").append('<img class="upgImg" src="img/buddhist.png"></img>');u.find(".upgradeList li.upgradeBuddhism").wrap('<span style="text-decoration: line-through;"></span>');$(this).replaceWith("[Cost 4 cheese");u.prev(".statRow").find(".ratCheese").text(parseInt(u.prev(".statRow").find(".ratCheese").text())-4);t(u);r(u,"Buddhism upgrade purchased");u.find(".upgradeList").first().show()}else if($(this).is(".upgradeAtkLink,.upgradeLifeLink,.upgradeDefLink,.upgradeSpdLink,.upgradeMealsLink,.upgradeLifeLink")){var p=parseInt($(this).find(".cheeseCost").text()),d=parseInt($(this).find(".cashCost").text()),v=parseInt($(this).prev(".upgradeCount").text()),m=parseInt(u.prev(".statRow").find(".ratCheese").text()),g=rats[u.prev(".statRow").find("td.ratName").text()]["Stats"],y=parseInt(u.find("li.cashSpentFood .cashSpentFood").text()),b=parseInt(u.find("li.cashSpentUpgrades .cashSpentUpgrades").text());u.find("li.cashSpentUpgrades .cashSpentUpgrades").text(b+d);u.find("li.cashSpentTotal .cashSpent").text(b+y+d);$(this).find(".cashCost").first().text(d+5e3);$(this).prev(".upgradeCount").text(v+1);v++;u.prev(".statRow").find(".ratCheese").text(m-p);if($(this).hasClass("upgradeAtkLink")){u.prev(".statRow").find(".ratAtk").text(parseInt(u.prev(".statRow").find(".ratAtk").text())+20);r(u,"Upgraded attack for "+p+" cheese")}else if($(this).hasClass("upgradeSpdLink")){u.prev(".statRow").find(".ratSpd").text(parseInt(u.prev(".statRow").find(".ratSpd").text())+20);r(u,"Upgraded speed for "+p+" cheese")}else if($(this).hasClass("upgradeDefLink")){u.prev(".statRow").find(".ratDef").text(parseInt(u.prev(".statRow").find(".ratDef").text())+20);r(u,"Upgraded defense for "+p+" cheese")}else if($(this).hasClass("upgradeMealsLink")){u.prev(".statRow").find(".ratMeals").text(parseInt(u.prev(".statRow").find(".ratMeals").text())+3);r(u,"Upgraded meals for "+p+" cheese");n(u)}else if($(this).hasClass("upgradeLifeLink")){u.prev(".statRow").find(".ratLife").text(parseInt(u.prev(".statRow").find(".ratLife").text())+g[0]);r(u,"Upgraded life (+"+g[0].toString()+") for "+p+" cheese")}if(v>0&&v%5==0){p++}$(this).find(".cheeseCost").text(p);t(u);u.find(".upgradeList").show()}else if($(this).hasClass("fastForwardLink")){i(u)}else if($(this).hasClass("abandonLink")){if(confirm("You sure you wanna murder this rat?!")==true){u.prev("tr").remove();u.next("tr").remove();u.remove()}}o.preventDefault()});$(".hideGraphLink").click(function(e){$("#chart").css("display","none").hide();$(this).hide();e.preventDefault()})})